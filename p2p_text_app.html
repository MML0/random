<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>WebRTC P2P Text Chat (No Server)</title>
  <style>
    body{ font-family:sans-serif; padding:20px; }
    textarea{ width:40%; height:100px; }
    input, button{ padding:8px; margin:4px 0; width:100%; }
    #chat{ border:1px solid #ccc; padding:10px; height:200px; overflow:auto; }
  </style>
</head>
<body>
<h2>WebRTC P2P Text Chat (No Server)</h2>

<button id="start">Create Connection</button>
<textarea id="localSDP" placeholder="Your SDP offer/answer"></textarea>
<textarea id="remoteSDP" placeholder="Paste remote SDP here"></textarea>
<button id="setRemote">Set Remote SDP</button>

<div id="chat"></div>
<input id="msg" placeholder="Type message..." />
<button id="send">Send</button>

<script>
let pc = null;
let dc = null;

function logChat(msg, self=false){
  const div = document.createElement('div');
  div.textContent = (self?'You: ':'Friend: ')+msg;
  document.getElementById('chat').appendChild(div);
  document.getElementById('chat').scrollTop = 1e10;
}

document.getElementById('start').onclick = async ()=>{
  pc = new RTCPeerConnection();

  dc = pc.createDataChannel('chat');
  dc.onmessage = e=> logChat(e.data);

  pc.ondatachannel = e=>{
    dc = e.channel;
    dc.onmessage = e=> logChat(e.data);
  };

  pc.onicecandidate = e=>{
    if(e.candidate===null){
      document.getElementById('localSDP').value = JSON.stringify(pc.localDescription);
    }
  };

  const offer = await pc.createOffer();
  await pc.setLocalDescription(offer);
};


document.getElementById('setRemote').onclick = async ()=>{
  const remote = JSON.parse(document.getElementById('remoteSDP').value);
  await pc.setRemoteDescription(remote);
  if(remote.type==='offer'){
    const answer = await pc.createAnswer();
    await pc.setLocalDescription(answer);
    document.getElementById('localSDP').value = JSON.stringify(pc.localDescription);
  }
};

document.getElementById('send').onclick = ()=>{
  const msg = document.getElementById('msg').value;
  if(dc && dc.readyState==='open'){
    dc.send(msg);
    logChat(msg,true);
    document.getElementById('msg').value='';
  }
};
</script>
</body>
</html>
